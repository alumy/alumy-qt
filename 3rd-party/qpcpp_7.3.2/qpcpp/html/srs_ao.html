<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>QP/C++: Active Objects</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="doxygen-awesome-darkmode-toggle.js"></script>
<script type="text/javascript" src="doxygen-awesome-fragment-copy-button.js"></script>
<script type="text/javascript" src="doxygen-awesome-paragraph-link.js"></script>
<script type="text/javascript" src="ql-preview.js"></script>
<script type="text/javascript">
    DoxygenAwesomeFragmentCopyButton.init()
    DoxygenAwesomeDarkModeToggle.init()
    DoxygenAwesomeParagraphLink.init()
</script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only-darkmode-toggle.css" rel="stylesheet" type="text/css"/>
<link href="ql-awesome.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
  <div id="projectlogo">
    <a href="https://www.state-machine.com" title="Quantum Leaps"><img alt="Logo" src="logo_ql.png"/></a>
  </div>
   <div id="projectname">
    QP/C++
    &nbsp;<span id="projectnumber">7.3.2</span>
   </div>
   <div id="projectbrief">Real-Time Embedded Framework</div>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.7 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;"
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('srs_ao.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Active Objects</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><span class="prev_button"><a class="el" href="srs_sm.html">State Machines</a></span><span class="next_button"><a class="el" href="srs_ed.html">Event Delivery</a></span> </p>
<h1><a class="anchor" id="srs_ao-def"></a>
Concepts &amp; Definitions</h1>
<p>As described in the <a class="el" href="srs_over.html">Overview</a>, the main goal of the <a class="el" href="namespace_q_p.html" title="QP/C++ framework.">QP</a> Framework is to provide a lightweight and efficient implementation of the <b>Active Object model of computation</b> with the specific focus on deeply embedded real-time systems, such as single-chip microcontroller units (MCUs).</p>
<h2><a class="anchor" id="srs_ao-sys"></a>
Active Objects in QP Framework</h2>
<p>The diagram below shows a <a class="el" href="namespace_q_p.html" title="QP/C++ framework.">QP</a> Application consisting of multiple, collaborating Active Objects that collectively deliver the desired functionality:</p>
<p><a class="anchor" id="srs_fig-03_01"></a></p><div class="image">
<img src="srs-ao.png" alt=""/>
</div>
  <div class="caption"><center><em>Figure 03_01: Active Objects in <a class="el" href="namespace_q_p.html" title="QP/C++ framework.">QP</a></em></center></div><p>Each Active Object has its own event queue and receives all events exclusively through that queue. On the other hand, events can be produced not only by Active Objects, but also interrupts (ISRs), or other software components. The Active Object infrastructure, such as the <a class="el" href="namespace_q_p.html" title="QP/C++ framework.">QP</a> Framework in this case, is responsible for delivering and queuing the events in a <em>deterministic</em> and <em>thread-safe</em> manner.</p>
<dl class="section note"><dt>Note</dt><dd>The internal state machines of Active Objects have been described in the <a class="el" href="srs_sm.html">previous section</a>. This section focuses on the internal event queues, threads and internal data of Active Objects.</dd></dl>
<h2><a class="anchor" id="srs_ao-enc"></a>
Encapsulation</h2>
<p>Perhaps the most important characteristic of Active Objects, from which Active Objects actually derive their name, is their strict <b>encapsulation</b>. Encapsulation means that Active Objects don't share data or any other resources. <a class="el" href="srs_ao.html#srs_fig-03_01">Figure 03_01</a> illustrates this aspect by a thick, opaque encapsulation shell around each Active Object and by showing the internal state machines in gray, since they are really not supposed to be visible from the outside.</p>
<dl class="section note"><dt>Note</dt><dd>The <a class="el" href="namespace_q_p.html" title="QP/C++ framework.">QP</a> Framework, especially when implemented in a programming language that does not support encapsulation (like C), cannot really guarantee the strict encapsulation of Active Objects. Achieving the encapsulation becomes then the responsibility of the <a class="el" href="namespace_q_p.html" title="QP/C++ framework.">QP</a> Applications. But at the very least, the <a class="el" href="namespace_q_p.html" title="QP/C++ framework.">QP</a> Framework needs to <em>allow</em> the <a class="el" href="namespace_q_p.html" title="QP/C++ framework.">QP</a> Applications to avoid sharing of resources among the Active Objects.</dd></dl>
<h2><a class="anchor" id="srs_ao-asynch"></a>
Asynchronous Communication</h2>
<p>All events are delivered to Active Objects <b>asynchronously</b>, meaning that an event producer merely posts an event to the event queue of the recipient Active Object but doesn't wait in line for the actual processing of the event.</p>
<p>The <a class="el" href="namespace_q_p.html" title="QP/C++ framework.">QP</a> Framework makes no distinction between external events generated from interrupts and internal events originating from Active Objects. As shown in <a class="el" href="srs_ao.html#srs_fig-03_01">Figure 03_01</a>, an Active Object can post events to any other Active Object, including to self. All events are treated uniformly, regardless of their origin.</p>
<h1><a class="anchor" id="srs_ao-rtc"></a>
Run-to-Completion (RTC)</h1>
<p>Each Active Object processes events in <b>run-to-completion (RTC) fashion</b>, which must be guaranteed by the underlying <a class="el" href="namespace_q_p.html" title="QP/C++ framework.">QP</a> Framework. RTC means that Active Objects process the events one at a time and the next event can only be processed after the previous event has been processed completely. RTC event processing is the essential requirement for proper execution of <a class="el" href="srs_sm.html">state machines</a>.</p>
<dl class="section note"><dt>Note</dt><dd>RTC event processing does <b>NOT</b> mean that an Active Object monopolizes the CPU until the RTC step is complete. In a multithreading environment, other threads or interrupts (not related to the thread context of the busy Active Object) <em>can</em> be running, possibly preempting the currently executing Active Object. But after every preemption, the preempted Active Object picks up where it left off and continues processing the current event, eventually completing its RTC step.</dd></dl>
<h2><a class="anchor" id="srs_ao-block"></a>
No Blocking</h2>
<p>Most traditional operating systems manage the threads and all inter-thread communication based on <em>blocking</em>, such as waiting on a time-delay or a semaphore. However, blocking (as in the middle of the RTC step) is <em>incompatible</em> with the <a class="el" href="srs_ao.html#srs_ao-rtc">RTC event processing requirement</a>. This is because every blocking call is really another way to deliver an <em>event</em> (event is delivered by unblocking and return from a blocking call). Such "backdoor" event delivery happening in the middle of the RTC step violates the RTC semantics, because after unblocking the Active Object needs to process two events at a time (the original one and the new one delivered by unblocking).</p>
<p>Another detrimental consequence of blocking (or polling for events) inside RTC steps is that Active Objects become <em>unresponsive</em> to events delivered to their event queues. This, in turn, can cause Active Objects to miss their hard-real time deadlines and also can cause overflow of the event queue.</p>
<p>Finally, blocking (or polling for events) means that the expected sequences of events are <em>hard-coded</em>, which is inherently inflexible and not extensible, especially if new events need to be added or the system must handle multiple event sequences.</p>
<h2><a class="anchor" id="srs_ao-thr"></a>
Thread of Control</h2>
<p>In the UML, Active Object is defined as: <em>"the object having its own thread of control"</em> <a class="el" href="srs.html#srs_ref">[UML 2.5]</a>. This might indeed be the case if the <a class="el" href="namespace_q_p.html" title="QP/C++ framework.">QP</a> Framework runs on top of a traditional multithreading kernel (e.g., traditional RTOS or general-purpose OS). However, the correct Active Object execution really requires the provision of a thread only <em>during</em> each RTC (Run-to-Completion) step. An Active Object that is merely <em>waiting</em> for event(s) does not need a thread at all. This opens up possibilities of using Active Objects with schedulers that don't support the notion of traditional threads. In that case Active Objects can collaborate in gaining access to the CPU only when needed.</p>
<dl class="section note"><dt>Note</dt><dd>It is very important to clearly distinguish the notion of RTC from the concept of preemption [OMG 07]. In particular, RTC does <em>not</em> mean that the Active Object thread has to monopolize the CPU until the RTC step is complete. In fact, RTC steps <em>can</em> be preempted by interrupts or other threads executing on the same CPU. Such thread preemption is determined by the scheduling policy of the underlying multitasking kernel, not by the Active Object model of computation. When the preempted Active Object is assigned the CPU time again, it resumes its event processing from the point of preemption and, eventually, completes its RTC step. As long as the preempting and the preempted threads donâ€™t share any resources (see <a class="el" href="srs_ao.html#srs_ao-enc">Encapsulation</a>), there are no concurrency hazards.</dd></dl>
<h2><a class="anchor" id="srs_ao-prio"></a>
Active Object Priority</h2>
<p>In real-time applications it is very useful to prioritize work by assigning priorities to threads, for example. <a class="el" href="namespace_q_p.html" title="QP/C++ framework.">QP</a> Framework takes it a bit further in that every Active Object is required to have a unique priority assigned to it. The Active Object priorities are then used as compact, unique identifiers of Active Objects.</p>
<h1><a class="anchor" id="srs_ao-req"></a>
Requirements</h1>
<p><a id="a35_REQ-QP-03_00" name="a35_REQ-QP-03_00"></a> </p>
<h2><a class="anchor" id="REQ-QP-03_00"></a>
REQ-QP-03_00</h2>
<table class="doxtable">
<tr>
<th>REQ-QP-03_00 </th></tr>
<tr style="text-align:left">
<th><a class="el" href="namespace_q_p.html" title="QP/C++ framework.">QP</a> Framework shall provide the Active Object abstraction to <a class="el" href="namespace_q_p.html" title="QP/C++ framework.">QP</a> Application </th></tr>
<tr>
<td><b>Description</b><br  />
 The <a class="el" href="namespace_q_p.html" title="QP/C++ framework.">QP</a> Framework shall define an event-driven Active Object abstraction, so that it can be customized by <a class="el" href="namespace_q_p.html" title="QP/C++ framework.">QP</a> Application and executed by <a class="el" href="namespace_q_p.html" title="QP/C++ framework.">QP</a> Framework according to the Active Object model of computation. </td></tr>
</table>
<p><a id="a36_REQ-QP-03_10" name="a36_REQ-QP-03_10"></a> </p>
<h2><a class="anchor" id="REQ-QP-03_10"></a>
REQ-QP-03_10</h2>
<table class="doxtable">
<tr>
<th>REQ-QP-03_10 </th></tr>
<tr style="text-align:left">
<th>Active Object abstraction shall provide <u>encapsulation</u> of its internals </th></tr>
<tr>
<td><b>Description</b><br  />
 One of the main characteristics of Active Objects is their strict encapsulation. While <a class="el" href="namespace_q_p.html" title="QP/C++ framework.">QP</a> Framework cannot strictly enforce such encapsulation, the framework should allow the <a class="el" href="namespace_q_p.html" title="QP/C++ framework.">QP</a> Application to hide such access from the <em>outside</em> of the AO. </td></tr>
<tr>
<td><b>Background</b><br  />
 <a class="el" href="namespace_q_p.html" title="QP/C++ framework.">QP</a> Framework cannot and is not required to enforce Active Object encapsulation alone. Instead, <a class="el" href="namespace_q_p.html" title="QP/C++ framework.">QP</a> Framework shall provide mechanisms that enable <em><a class="el" href="namespace_q_p.html" title="QP/C++ framework.">QP</a> Application</em> to hide internal details of selected active objects. Also, this requirement does not prevent <a class="el" href="namespace_q_p.html" title="QP/C++ framework.">QP</a> Application from exposing some internal aspects of selected Active Objects, if the Application so chooses. </td></tr>
</table>
<p><a id="a37_REQ-QP-03_11" name="a37_REQ-QP-03_11"></a> </p>
<h2><a class="anchor" id="REQ-QP-03_11"></a>
REQ-QP-03_11</h2>
<table class="doxtable">
<tr>
<th>REQ-QP-03_11 </th></tr>
<tr style="text-align:left">
<th>Active Object abstraction shall allow Applications to easily access the internal attributes from inside the Active Object </th></tr>
<tr>
<td><b>Description</b><br  />
 Notwithstanding Requirement <a class="el" href="srs_ao.html#REQ-QP-03_10">REQ-QP-03_10</a>, <a class="el" href="namespace_q_p.html" title="QP/C++ framework.">QP</a> framework shall allow for easy and computationally inexpensive access to the internal attributes of an Active Object from <em>within</em> the AO, such as from its internal state machine. </td></tr>
<tr>
<td><b>Background</b><br  />
 A good example of implementing such a policy is the concept of class encapsulation in OOP, where the internal attributes are accessible to the class operations (e.g., via the <code>this</code> pointer) and are harder to access from the outside. </td></tr>
<tr>
<td><b>Related To</b><br  />
 <a class="el" href="srs_sm.html#REQ-QP-02_24">REQ-QP-02_24</a> </td></tr>
</table>
<p><a id="a38_REQ-QP-03_20" name="a38_REQ-QP-03_20"></a> </p>
<h2><a class="anchor" id="REQ-QP-03_20"></a>
REQ-QP-03_20</h2>
<table class="doxtable">
<tr>
<th>REQ-QP-03_20 </th></tr>
<tr style="text-align:left">
<th>Active Object abstraction shall support <u>asynchronous event posting</u> </th></tr>
<tr>
<td><b>Description</b><br  />
 </td></tr>
</table>
<p><a id="a39_REQ-QP-03_30" name="a39_REQ-QP-03_30"></a> </p>
<h2><a class="anchor" id="REQ-QP-03_30"></a>
REQ-QP-03_30</h2>
<table class="doxtable">
<tr>
<th>REQ-QP-03_30 </th></tr>
<tr style="text-align:left">
<th>Active Object abstraction shall support <u>run-to-completion event processing</u> </th></tr>
<tr>
<td><b>Description</b><br  />
 </td></tr>
</table>
<p><span class="prev_button"><a class="el" href="srs_sm.html">State Machines</a></span><span class="next_button"><a class="el" href="srs_ed.html">Event Delivery</a></span>  </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.9.2-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="srs.html">Software Requirements Specification</a></li>
    <li class="footer">
<a title="Quantum Leaps: Modern Embedded Software" href="https://www.state-machine.com">&copy; 2005-2023 Quantum Leaps</a> &nbsp;|&nbsp; <a title="help" href="help.html">Using Online Help</a> &nbsp;|&nbsp; <b>QP/C++ 7.3.2</b> &nbsp;|&nbsp; Updated on Thu Dec 14 2023
<hr class="footer"/><address class="footer"><small>
<a title="Quantum Leaps: Modern Embedded Software" href="https://www.state-machine.com">&copy; 2005-2023 Quantum Leaps</a> &nbsp;|&nbsp; <a title="help" href="help.html">Using Online Help</a> &nbsp;|&nbsp; <b>QP/C++ 7.3.2</b> &nbsp;|&nbsp; Updated on Thu Dec 14 2023
</small></address>
    </li>
  </ul>
</div>
</body>
</html>
